@model ImmoWhatApp.Models.Commune

@{
    ViewBag.Title = "Graphic";
}


<div class="row">
    <div class="col-lg-3 carte">
        <div class="col-12">
            Homegraphique-prixWaterloo
        </div>
        <div class="col-12">
            <input type="text" placeholder="@Model.Localite" />
        </div>

        <div id="map" class="col-lg-12" style="width:100%; height:100%;"></div>

    </div>

    <div class="col-lg-9"  >
        <div class="row" style="padding-left:3%; padding-top:5%;">
            <ul class="nav nav-tabs col-lg-12" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="tablePrix-tab" data-toggle="tab" href="#tablePrix" role="tab" aria-controls="tablePrix" aria-selected="true">tablePrix</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="graphique-tab" data-toggle="tab" href="#graphique" role="tab" aria-controls="graphique" aria-selected="false">graphique</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="poi-tab" data-toggle="tab" href="#poi" role="tab" aria-controls="poi" aria-selected="false">poi</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="comment-tab" data-toggle="tab" href="#comment" role="tab" aria-controls="comment" aria-selected="false">comment</a>
                </li>
            </ul>
            <div class="tab-content row" id="myTabContent" style="height:75vh; padding-top:5vh" >
                <div class="col-lg-12 tab-pane fade show active" id="tablePrix" role="tabpanel" aria-labelledby="tablePrix-tab" style="position: relative; height:40vh; width:60vw">
                    <h2 class="titreSecPage">table de prix</h2>
                    <div id="tablePrixView" class="col-lg-12">
                        @*ici, la table des prix*@
                    </div>
                    <input class="col-lg-3" />
                </div>
                <div class="tab-pane fade" id="graphique" role="tabpanel" aria-labelledby="graphique-tab">
                    <div id="graph" class="chart-container" style="position: relative; height:40vh; width:60vw">
                        <h2 class="titreSecPage">graphique</h2>
                        @*<canvas id="myChart"></canvas>*@
                        <div id="myChart" style="width: 1000px; height: 100%"></div>
                    </div>
                </div>
                <div class="tab-pane fade" id="poi" role="tabpanel" aria-labelledby="poi-tab">
                    poia
                </div>
                <div class="tab-pane fade" id="comment" role="tabpanel" aria-labelledby="comment-tab">
                    commentaire
                </div>
            </div>
            <div class="row">

            </div>

            <div style="display:none" id="poiView">
                Point of interest
            </div>
            <div style="display:none" id="commentView">
                commentaires
            </div>
        </div>
    </div>
</div>
<div id="chart_div"></div>
<input id="codePost" style="display:none" value="@Model.CodePostal" />
<input id="bouton" style="display:none" value="@ViewBag.bouton" />


<img id="chargement" src="~/img/loaders/infini.gif" style="display: none" alt="Chargement en cours..." class="loaderConnection col-md-offset-5 col-md-2 col-md-offset-5" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>

<script>

    function myMap() {
        var mapProp = {
            center: new google.maps.LatLng(@Model.latitude, @Model.longitude),
            zoom: 13,
        };
        var map = new google.maps.Map(document.getElementById("map"), mapProp);
    }
</script>

<script type="text/javascript">
    

    //$(".nav").find(".active").removeClass("active");
    //$('#graphique').addClass("active");
    $(document).ready(function () {
        var bouton = $('#bouton').val();

        if (bouton == "graph") {

            $(document).ready(GetGraphique);
        }
        else if (bouton == "tablePrix") {
            $('#poi').hide();

            $(document).ready(GetStat);
        }
        else if (bouton == "poi") {
            $(".nav").find(".active").removeClass("active");
            $('#poi-tab').addClass("active");
            
            $('#poi').addClass("show");
            $('#poi').show()
        }
        else {
            $(".nav").find(".active").removeClass("active");
            $('#comment-tab').addClass("active");
            
            $('#comment').addClass("show");
            $('#comment').show()
        }
    })
    
    

    $('#graphique-tab').click(GetGraphique);
    $('#tablePrix-tab').click(GetStat);
    $('#poi-tab').click(function () {
        $('#graphique').hide();
        $('#comment').hide();
        $('#tablePrix').hide();
        $('#poi').addClass("show");
        $('#poi').show();
    })
    $('#comment-tab').click(function () {
        $('#graphique').hide();
        $('#poi').hide();
        $('#tablePrix').hide();
        $('#comment').addClass("show");
        $('#comment').show()
    })



    function GetGraphique() {
        $(".nav").find(".active").removeClass("active");
        $('#graphique-tab').addClass("active");
        $('#poi').hide();
        $('#comment').hide();
        $('#tablePrix').hide();
        $('#graphique').addClass("show");
        $('#graphique').show()
            
            $("#chargement").show();
            var codePost = $('#codePost').val();
            $.ajax({
                type: 'GET',
                datatype: 'json',
                url: '@Url.Action("GetJsonResultGraph", "Stat")',
                data: { codePostal: codePost, },
                success: function (donnee) {
                    // Load the Visualization API and the corechart package.
                    google.charts.load('current', { 'packages': ['corechart'] });

                    // Set a callback to run when the Google Visualization API is loaded.
                    google.charts.setOnLoadCallback(drawChart);

                    // Callback that creates and populates a data table,
                    // instantiates the pie chart, passes in the data and
                    // draws it.
                    function drawChart() {
                        var data = google.visualization.arrayToDataTable([
                            ['année', 'prix moyen villa', 'prix moyen maison', 'prix moyen terrain', 'prix moyen appartement'],
                            [donnee.resultat[0].annee.toString(), donnee.resultat[0].moyennePrixVilla, donnee.resultat[0].moyennePrixMaison, donnee.resultat[0].moyennePrixTerrain, donnee.resultat[0].moyennePrixAppartement],
                            [donnee.resultat[1].annee.toString(), donnee.resultat[1].moyennePrixVilla, donnee.resultat[1].moyennePrixMaison, donnee.resultat[1].moyennePrixTerrain, donnee.resultat[1].moyennePrixAppartement],
                            [donnee.resultat[2].annee.toString(), donnee.resultat[2].moyennePrixVilla, donnee.resultat[2].moyennePrixMaison, donnee.resultat[2].moyennePrixTerrain, donnee.resultat[2].moyennePrixAppartement],
                            [donnee.resultat[3].annee.toString(), donnee.resultat[3].moyennePrixVilla, donnee.resultat[3].moyennePrixMaison, donnee.resultat[3].moyennePrixTerrain, donnee.resultat[3].moyennePrixAppartement],
                            [donnee.resultat[4].annee.toString(), donnee.resultat[4].moyennePrixVilla, donnee.resultat[4].moyennePrixMaison, donnee.resultat[4].moyennePrixTerrain, donnee.resultat[4].moyennePrixAppartement],
                            [donnee.resultat[5].annee.toString(), donnee.resultat[5].moyennePrixVilla, donnee.resultat[5].moyennePrixMaison, donnee.resultat[5].moyennePrixTerrain, donnee.resultat[5].moyennePrixAppartement]
                            
                        ]);
                        var options = {
                            pointsVisible: true,
                            curveType: 'function',
                            legend: {
                                position: 'bottom',
                                textStyle: {
                                    color: '#01579b',
                                    fontSize: 15,
                                    fontName: 'Arial',
                                    bold: true,
                                    italic: true
                                }
                            },
                            hAxis: {
                                title: 'année',
                                textStyle: {
                                    color: '#01579b',
                                    fontSize: 15,
                                    fontName: 'Arial',
                                    bold: true,
                                    italic: true
                                },
                                titleTextStyle: {
                                    color: '#01579b',
                                    fontSize: 20,
                                    fontName: 'Arial',
                                    bold: true,
                                    italic: true
                                }
                            },
                            vAxis: {
                                title: 'prix ( € )',
                                textStyle: {
                                    color: '#01579b',
                                    fontSize: 15,
                                    fontName: 'Arial',
                                    bold: true,
                                    italic: true
                                },
                                titleTextStyle: {
                                    color: '#01579b',
                                    fontSize: 20,
                                    fontName: 'Arial',
                                    bold: true,
                                    italic: true
                                }
                            },
                            
                        };

                        // Instantiate and draw our chart, passing in some options.
                        var chart = new google.visualization.LineChart(document.getElementById('myChart'));
                        chart.draw(data, options);
                    }

                    //var ctx = document.getElementById('myChart').getContext('2d');
                    
                    //var chart = new Chart(ctx, {
                    //    // The type of chart we want to create
                    //    type: 'line',
                        
                    //    // The data for our dataset
                    //    data: {
                    //        labels: [donnee.resultat[0].annee, donnee.resultat[1].annee, donnee.resultat[2].annee, donnee.resultat[3].annee, donnee.resultat[4].annee, donnee.resultat[5].annee],
                    //        datasets: [
                    //            {
                    //                label: "prix moyen villa",
                    //                borderColor: '#FF0004',
                    //                data: [donnee.resultat[0].moyennePrixVilla, donnee.resultat[1].moyennePrixVilla, donnee.resultat[2].moyennePrixVilla, donnee.resultat[3].moyennePrixVilla, donnee.resultat[4].moyennePrixVilla, donnee.resultat[5].moyennePrixVilla],
                    //            },
                    //            {
                    //                label: "prix moyen maison",
                    //                borderColor: '#B75814',
                    //                data: [donnee.resultat[0].moyennePrixMaison, donnee.resultat[1].moyennePrixMaison, donnee.resultat[2].moyennePrixMaison, donnee.resultat[3].moyennePrixMaison, donnee.resultat[4].moyennePrixMaison, donnee.resultat[5].moyennePrixMaison],
                    //            },
                    //            {
                    //                label: "prix moyen terrain",
                    //                borderColor: '#49FA14',
                    //                data: [donnee.resultat[0].moyennePrixTerrain, donnee.resultat[1].moyennePrixTerrain, donnee.resultat[2].moyennePrixTerrain, donnee.resultat[3].moyennePrixTerrain, donnee.resultat[4].moyennePrixTerrain, donnee.resultat[5].moyennePrixTerrain],
                    //            },
                    //            {
                    //                label: "prix moyen appartement",
                    //                borderColor: '#4214FA',
                    //                data: [donnee.resultat[0].moyennePrixAppartement, donnee.resultat[1].moyennePrixAppartement, donnee.resultat[2].moyennePrixAppartement, donnee.resultat[3].moyennePrixAppartement, donnee.resultat[4].moyennePrixAppartement, donnee.resultat[5].moyennePrixAppartement],
                    //            },

                    //        ]
                    //    },

                    //    // Configuration options go here
                    //    options: {
                            
                    //        legend: {
                    //            position: 'bottom',
                    //            labels: {
                    //                boxWidth: 60,
                    //                fontSize: 20,
                    //                padding: 30
                    //            }
                    //        }
                    //    }
                    //});
                    $("#chargement").hide();
                    //$('#graph').show();
                },
                error: function () {
                    alert("une erreur s'est produite...")
                }
            });
    };
    function GetStat() {
        //$('#tablePrix').attr('class', 'btn btn-success');
        //    $('#graphique').attr('class', 'btn btn-danger');
        //    $('#poi').attr('class', 'btn btn-danger');
        //    $('#comment').attr('class', 'btn btn-danger');

            //$('#graph').hide();
            //$('#poiView').hide();
            //$('#commentView').hide();

        $(".nav").find(".active").removeClass("active");
        $('#tablePrix-tab').addClass("active");

        $('#poi').hide();
        $('#comment').hide();
        $('#graphique').hide();

        $('#tablePrix').addClass("show");
        $('#tablePrix').show()
            $("#chargement").show();

            var codePost = $('#codePost').val();
            var anneeRecherche = 2010;
            $.ajax({
                type: 'GET',
                datatype: 'json',
                url: '@Url.Action("GetJsonTablePriceStat", "Stat")',
                data: { anneeRecherchee: anneeRecherche, codePostal: codePost, },
                success: function (donnee) {
                    var table = '<table class="table" id="tableStat"> <thead> <tr> <th>type</th><th>2000</th><th>2014</th><th>2015</th> </tr> </thead> <tbody>';
                    var x = 0;
                    while (x < 4) {
                        table = table + '<tr> <td>' + donnee.resultat[x].type + '</td><td>' + donnee.resultat[x].anneeRecherche + '</td><td>' + donnee.resultat[x].anneePrecedente + '</td><td>' + donnee.resultat[x].anneeCourante + '</td> </tr>'
                        x += 1;
                    }
                    table += ' </tbody> </table>';

                    $("#chargement").hide();
                    
                    //$('#tablePrixView').show();
                    $('#tablePrixView').html(table);
                    

                },
                error: function () {
                    alert("une erreur s'est produite...")
                }
            })
    }

   
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCHaJXOb3KVvODTc1FDLpY44cpoUctO0u0&callback=myMap"></script>




